<!DOCTYPE html>
<head>
  <title>HELMED</title>
</head>
<meta charset="utf-8">
<div class="right">
  <button id="start_button" onclick="startButton(event)">
    <img id="start_img" src="mic.gif" alt="Start"></button>
</div>
<div id="results">
  <span id="final_span" class="final"></span>
  <span id="interim_span" class="interim"></span>
  <p>
</div>
<script>
var txt = '';
var idts = [];
var x;
var tosym = '';
var tosplit = [];
var res;
var final_transcript = '';
var recognizing = false;
var symps = ['DIZZINESS', 'COUGH', 'FEVER'];
if (!('webkitSpeechRecognition' in window)) {
  upgrade();
} 
else {
  start_button.style.display = 'inline-block';
  var recognition = new webkitSpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.onstart = function() {
    recognizing = true;
    start_img.src = 'mic-animate.gif';
  };
  recognition.onend = function() {
    recognizing = false;
    if (ignore_onend) {
      return;
    }
    start_img.src = 'mic.gif';
    if (window.getSelection) {
      window.getSelection().removeAllRanges();
      var range = document.createRange();
      range.selectNode(document.getElementById('final_span'));
      window.getSelection().addRange(range);
    }
  };
  recognition.onresult = function(event) {
    var interim_transcript = '';
    for (var i = event.resultIndex; i < event.results.length; ++i) {
      if (event.results[i].isFinal) {
        final_transcript += event.results[i][0].transcript;
      } 
      else {
        interim_transcript += event.results[i][0].transcript;
      }
    }
    final_span.innerHTML = linebreak(final_transcript);
    tosplit = final_transcript.split(" ");
    for (var i=0; i <= tosplit.length -1; i++) {
      tosplit[i] = tosplit[i].toUpperCase();
      for (var j =0; j<= symps.length - 1; j++) {
        if(symps[j] == tosplit[i]) {
          break;
        }
      }
      if(j==symps.length) {
        delete tosplit[i];
      }
    }
    res = tosplit;
    res.sort();
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        x = JSON.parse(this.responseText);
        //console.log("here");
        for (var i = 0; i < x.length; i++) {
          //console.log(idts);
          for (var j = res.length - 1; j >= 0; j--) {
            // console.log(x[i]["ID"]);
            if(res[j] == x[i]["Name"].toUpperCase()) {
              // console.log("jj");//x[i]["ID"]);
             // console.log(idts.length);
              console.log(idts.concat(x[i]["ID"]));
              idts = idts.concat(x[i]["ID"]);
              break;
            }
          //txt += x[i].childNodes[0].nodeValue;
          }
        }
      }
    };

              console.log(idts);
    xhttp.open("GET", "https://sandbox-healthservice.priaid.ch/symptoms?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6ImphaW5yaXNoYWIxOTk2QGdtYWlsLmNvbSIsInJvbGUiOiJVc2VyIiwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvc2lkIjoiMTE1MSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvdmVyc2lvbiI6IjIwMCIsImh0dHA6Ly9leGFtcGxlLm9yZy9jbGFpbXMvbGltaXQiOiI5OTk5OTk5OTkiLCJodHRwOi8vZXhhbXBsZS5vcmcvY2xhaW1zL21lbWJlcnNoaXAiOiJQcmVtaXVtIiwiaHR0cDovL2V4YW1wbGUub3JnL2NsYWltcy9sYW5ndWFnZSI6ImVuLWdiIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9leHBpcmF0aW9uIjoiMjA5OS0xMi0zMSIsImh0dHA6Ly9leGFtcGxlLm9yZy9jbGFpbXMvbWVtYmVyc2hpcHN0YXJ0IjoiMjAxNy0wMi0xMCIsImlzcyI6Imh0dHBzOi8vc2FuZGJveC1hdXRoc2VydmljZS5wcmlhaWQuY2giLCJhdWQiOiJodHRwczovL2hlYWx0aHNlcnZpY2UucHJpYWlkLmNoIiwiZXhwIjoxNDg2ODE4MDE3LCJuYmYiOjE0ODY4MTA4MTd9.Gx21zdnC9l6HVX_7VYceo8ptXzAuQOoILZizpOGoy40&language=en-gb&format=json", true);
    xhttp.send();


    //document.getElementById("demo").innerHTML += id ;
     var xhttp1 = new XMLHttpRequest();
    xhttp1.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        x = JSON.parse(this.responseText);
          console.log(x);
        }
        //txt += x[i].childNodes[0].nodeValue;
    };
    console.log(idts);
    xhttp1.open("GET", "https://sandbox-healthservice.priaid.ch/diagnosis/specialisations?symptoms=[\"13\"]&gender=male&year_of_birth=1988&token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJlbWFpbCI6ImphaW5yaXNoYWIxOTk2QGdtYWlsLmNvbSIsInJvbGUiOiJVc2VyIiwiaHR0cDovL3NjaGVtYXMueG1sc29hcC5vcmcvd3MvMjAwNS8wNS9pZGVudGl0eS9jbGFpbXMvc2lkIjoiMTE1MSIsImh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd3MvMjAwOC8wNi9pZGVudGl0eS9jbGFpbXMvdmVyc2lvbiI6IjIwMCIsImh0dHA6Ly9leGFtcGxlLm9yZy9jbGFpbXMvbGltaXQiOiI5OTk5OTk5OTkiLCJodHRwOi8vZXhhbXBsZS5vcmcvY2xhaW1zL21lbWJlcnNoaXAiOiJQcmVtaXVtIiwiaHR0cDovL2V4YW1wbGUub3JnL2NsYWltcy9sYW5ndWFnZSI6ImVuLWdiIiwiaHR0cDovL3NjaGVtYXMubWljcm9zb2Z0LmNvbS93cy8yMDA4LzA2L2lkZW50aXR5L2NsYWltcy9leHBpcmF0aW9uIjoiMjA5OS0xMi0zMSIsImh0dHA6Ly9leGFtcGxlLm9yZy9jbGFpbXMvbWVtYmVyc2hpcHN0YXJ0IjoiMjAxNy0wMi0xMCIsImlzcyI6Imh0dHBzOi8vc2FuZGJveC1hdXRoc2VydmljZS5wcmlhaWQuY2giLCJhdWQiOiJodHRwczovL2hlYWx0aHNlcnZpY2UucHJpYWlkLmNoIiwiZXhwIjoxNDg2ODE4MDE3LCJuYmYiOjE0ODY4MTA4MTd9.Gx21zdnC9l6HVX_7VYceo8ptXzAuQOoILZizpOGoy40&language=en-gb&format=json", true);
    console.log("idts");
    xhttp1.send();
    //document.getElementById("demo").innerHTML += id ;
    


    //interim_span.innerHTML = linebreak(interim_transcript);
  };
}
var two_line = /\n\n/g;
var one_line = /\n/g;
function linebreak(s) {
  return s.replace(two_line, '<p></p>').replace(one_line, '<br>');
}
var first_char = /\S/;
function capitalize(s) {
  return s.replace(first_char, function(m) { return m.toUpperCase(); });
}
function startButton(event) {
  if (recognizing) {
    recognition.stop();
    return;
  }
  final_transcript = '';
  recognition.lang = 'en-US';
  recognition.start();
  ignore_onend = false;
  final_span.innerHTML = '';
  interim_span.innerHTML = '';
  start_img.src = 'mic-slash.gif';
  start_timestamp = event.timeStamp;
}
var TextSpeech="Drink warm water. Wear warm clothes. Crocin 500mg.";
</script>

<script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <input onclick='responsiveVoice.speak(TextSpeech);' type='button' value='ðŸ”Š Play' />
<p id="demo"></p>






